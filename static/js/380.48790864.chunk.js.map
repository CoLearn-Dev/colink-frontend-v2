{"version":3,"file":"static/js/380.48790864.chunk.js","mappings":"yYAoDO,SAASA,EAAkBC,GAChC,OAAOA,EAAKC,UAAU,EAAGD,EAAKE,QAAQ,KACxC,CAEO,SAASC,EAAYH,GAC1B,MAA0B,OAAnBA,EAAKI,OAAO,EACrB,EARAC,EAAAA,EAAAA,IAAkB,CAAEC,cAAeC,EAAAA,IAUnC,IAAMC,EAAW,yCAAG,WAAOR,EAAcS,GAAkB,8EAEhC,OADrBC,EAAiBX,EAAkBC,GACnCW,EAAmB,GAAE,SACnBF,EAASC,GAAQE,MAAK,SAACC,GAC3BF,EAAQG,MAAMC,KAAKF,GAAMG,KAAI,SAACC,GAQ5B,MAPsB,CACpBC,GAAID,EACJE,MAAMC,EAAAA,EAAAA,IAAoBH,GAC1BI,MAAOlB,EAAYc,GACnBK,UAAU,EACVC,IAAK,GAGT,GACF,IAAE,gCACKC,QAAQC,QAAQd,IAAM,2CAC9B,gBAhBgB,wCAkBXe,EAAc,yCAAG,WAAO1B,GAAY,wFAYxC,IAXI2B,EAAsB,CACxBT,GAAI,IACJC,KAAM,OACNG,UAAU,EACVD,OAAO,GAEHO,EAAc,GAEdC,EAAQ7B,EAAKC,UAAU,EAAGD,EAAKE,QAAQ,OAAS,KAClD4B,EAAM9B,EAAKC,UAAUD,EAAKE,QAAQ,MAAQ,GAE/B,KAAR4B,GAEDC,EAAkB,CACpBb,GAFEc,EAAWH,EAAQC,EAGrBX,MAAMC,EAAAA,EAAAA,IAAoBY,GAC1BX,MAAOlB,EAAY6B,GACnBV,UAAU,GAEZM,EAAYK,QAAQF,GAEhBG,EAAYJ,EAAIK,YAAY,KAE9BL,GADiB,IAAfI,EACIJ,EAAI7B,UAAU,EAAGiC,GAAa,KAE9B,GAIoB,OAA9BN,EAAYK,QAAQN,GAAU,kBAEvBH,QAAQC,QAAQG,IAAY,2CACpC,gBAjCmB,sCAmCPQ,EAAuB,SAACC,EAAmBC,GACtD,OAAOC,EAAAA,EAAAA,cACL,SAACC,GACKA,EAAKtB,KAAOuB,EAAAA,GAAAA,UAAAA,IACyB,qBAA5BD,EAAKE,QAAQC,aAClBH,EAAKE,QAAQC,WAAWtB,MAE1BgB,EAAQG,EAAKE,QAAQC,WAAWzB,IAEhCoB,GAAaM,EAAAA,EAAAA,IAAgBJ,EAAKE,QAAQC,WAAWzB,KAI7D,GACA,CAACmB,GAEL,EAcMQ,EAMD,SAACC,GACJ,OAA0BC,EAAAA,EAAAA,UAA8B,IAAG,eAApDpC,EAAK,KAAEqC,EAAQ,KACtB,GAAsCD,EAAAA,EAAAA,UAA8B,IAAG,eAAhEnB,EAAW,KAAEqB,EAAc,MAElCC,EAAAA,EAAAA,YAAU,WACwB,aAK/B,OAL+B,0BAAhC,mGACQxB,EAAeoB,EAAM9C,MAAMY,MAAK,SAACuC,GACrCF,GAAe,OAAIE,GACrB,IAAE,iCACK,GAAI,4CACZ,sBACyB,aAKzB,OALyB,0BAA1B,mGACQ3C,EAAYsC,EAAM9C,KAAM8C,EAAMM,SAASxC,MAAK,SAACD,GACjDqC,GAAS,OAAIrC,GACf,IAAE,iCACK,GAAI,2CACZ,yBANA,WACyB,wBAM1B0C,GAbe,WACiB,wBAahCC,EACF,GAAG,CAACR,EAAM9C,OAEV,IAAMuD,EAAmBnB,EAAqBU,EAAMT,QAASS,EAAMR,cACnE,OACE,gBAAKkB,MAAO,CAAEC,OAAQ,KAAM,UAC1B,UAAC,KAAW,CACVC,WAAYZ,EAAMY,WAClB/C,MAAOA,EAEPiB,YAAaA,EACb+B,aAAcJ,EACdK,mBAAoB,SAACC,GAAc,OAAK,IAAI,EAAC,WAE7C,SAAC,KAAU,KACX,SAAC,KAAW,KACZ,SAAC,KAAQ,KACT,SAAC,KAAe,QAIxB,EAiJA,UA/I4B,WAC1B,IAAQC,GAAQC,EAAAA,EAAAA,KAAY,SAACC,GAAU,OAAKA,EAAMF,GAAG,IAA7CA,IACAG,GAAWF,EAAAA,EAAAA,KAAY,SAACC,GAAU,OAAKA,EAAMC,MAAM,IAAnDA,OAIR,IAHiBC,EAAAA,EAAAA,OAGOnB,EAAAA,EAAAA,UAAS,KAAG,eAA7B/C,EAAI,KAAEqC,EAAO,KAGd8B,EAAW,IAAIC,EAAAA,aACrB,GAA+BrB,EAAAA,EAAAA,UAASoB,GAAS,eAA1CpC,EAAK,KAAEsC,EAAa,KAC3B,GAAiCtB,EAAAA,EAAAA,WAAS,GAAM,eAAzCuB,EAAO,KAAEC,EAAa,KAC7B,GAAgCxB,EAAAA,EAAAA,UAAS,GAAE,eAApCyB,EAAU,KAAEC,EAAS,KAEE,aAgB7B,OAhB6B,0BAA9B,WAA+B/D,GAAc,4EACnB,GAApBgE,EAAkB,GACP,KAAXhE,EAAa,iCACTiE,EAAAA,EAAAA,IAAsBV,EAAQH,GAAKlD,MAAK,SAACgE,GAC7CF,EAAQE,EAAQ5D,KAAI,SAACe,GACnB,OAAOA,EAAM8C,YACf,GACF,IAAE,8CAEIF,EAAAA,EAAAA,IAAsBV,EAAQH,EAAKpD,GAAQE,MAAK,SAACgE,GACrDF,EAAQE,EAAQ5D,KAAI,SAACe,GACnB,OAAOA,EAAM8C,YACf,GACF,IAAE,gCAEGrD,QAAQC,QAAQiD,IAAM,2CAC9B,wBAE0B,aAK1B,OAL0B,0BAA3B,WAA4BI,GAAe,uFACnCC,EAAAA,EAAAA,IAAUd,EAAQH,EAAKgB,GAASlE,MAAK,SAACmB,GAC1CsC,EAActC,GACdwC,GAAc,EAChB,IAAE,2CACH,wBAQD,OANArB,EAAAA,EAAAA,YAAU,WACI,KAARY,GAAyB,KAAXG,GAChB5B,EAAQ,IAEZ,GAAG,CAACyB,EAAKG,KAGP,iCACE,UAAC,KAAK,CAACe,UAAU,OAAM,WACrB,SAAC,KAAS,WACR,SAAC,KAAI,WACH,SAAC,KAAI,CAACC,GAAI,EAAE,UACV,eAAI/D,GAAG,UAAU8D,UAAU,kBAAiB,SAAC,2BAMnD,SAAC,KAAW,WACV,SAAC,KAAI,CAACA,UAAU,cAAa,UAC3B,SAACnC,EAAkB,CACjBa,WAAW,KACX1D,KAAMA,EACNqC,QAASA,EACTe,QAnD+B,SAEZ,GAAD,gCAkDlBd,aAlCX,SAE2B,GAAD,0CAsCvB,UAAC,KAAM,CACL4C,KAAK,KACLC,SAAS,SACT3B,MAAO,CAAE4B,SAAU,MAAOC,WAAY,SACtCf,QAASA,EACTgB,QAAS,kBAAMf,GAAc,EAAM,EACnCgB,UAAU,SAAQ,WAElB,SAAC,KAAY,WACX,UAAC,KAAW,WAAC,UAAQjB,GAAUlD,EAAAA,EAAAA,IAAoBW,EAAM8C,cAAgB,SAE3E,UAAC,KAAU,YACT,SAAC,KAAU,WACT,UAAC,KAAI,CAACW,QAAQ,OAAOC,KAAK,UAAS,WACjC,SAAC,KAAQ,WACP,SAAC,KAAQ,CAACC,OAAuB,IAAflB,EAAkBmB,QAAS,kBAAMlB,EAAU,EAAE,EAAC,SAAC,cAInE,SAAC,KAAQ,WACP,SAAC,KAAQ,CAACiB,OAAuB,IAAflB,EAAkBmB,QAAS,kBAAMlB,EAAU,EAAE,EAAC,SAAC,cAInE,SAAC,KAAQ,WACP,SAAC,KAAQ,CAACiB,OAAuB,IAAflB,EAAkBmB,QAAS,kBAAMlB,EAAU,EAAE,EAAC,SAAC,mBAMvE,SAAC,KAAU,WACT,SAAC,KAAK,CAACO,UAAU,MAAK,UACpB,UAAC,KAAS,CAACA,UAAU,cAAa,WAChC,gBACExB,MAAO,CACLoC,WAAY,WACZC,UAAW,OACXC,aAAc,aACdC,MAAO,QACP,SAEDzB,EAAU0B,KAAKC,WAAUC,EAAAA,EAAAA,IAAmBnE,EAAOyC,GAAa,KAAM,GAAK,MAE9E,SAAC,KAAO,CAACQ,UAAU,OAAOU,QAAM,EAACS,UAAW,EAAGC,MAAM,QAAO,UAC1D,cACEC,SAAS,cACTC,KACEhC,GACIiC,EAAAA,EAAAA,IACEP,KAAKC,WAAUC,EAAAA,EAAAA,IAAmBnE,EAAOyC,GAAa,KAAM,IAE9D,IAENhB,MAAO,CAAEgD,eAAgB,OAAQJ,MAAO,SAAU,SACnD,gCAQX,SAAC,KAAY,WACX,SAAC,KAAO,CAACA,MAAM,YAAYT,QAAS,kBAAMpB,GAAc,EAAM,EAAC,SAAC,iBAO1E,C","sources":["views/dashboard/Dashboard.tsx"],"sourcesContent":["import React, { useEffect } from 'react'\n\nimport {\n  CButton,\n  CCard,\n  CCardBody,\n  CCardFooter,\n  CCardGroup,\n  CCol,\n  CModal,\n  CModalBody,\n  CModalFooter,\n  CModalHeader,\n  CModalTitle,\n  CRow,\n  CNav,\n  CNavItem,\n  CNavLink,\n  CTabContent,\n  CTabPane,\n} from '@coreui/react'\n\nimport {\n  defineFileAction,\n  ChonkyActions,\n  ChonkyFileActionData,\n  FileArray,\n  FileBrowser,\n  FileContextMenu,\n  FileData,\n  FileList,\n  FileNavbar,\n  FileToolbar,\n  setChonkyDefaults,\n} from 'chonky'\n\nimport { ChonkyIconFA } from 'chonky-icon-fontawesome'\nimport { useCallback, useState } from 'react'\n\nimport { useDispatch, useSelector } from 'react-redux'\nimport {\n  getUserStorageEntries,\n  keyNameFromPath,\n  lastKeyNameFromPath,\n  readEntry,\n  storageEntryToJSON,\n} from 'src/lib'\nimport { StorageEntry } from 'src/proto_js/colink_pb'\nimport { createDownloadHref } from 'src/utils'\n\nsetChonkyDefaults({ iconComponent: ChonkyIconFA })\n\nexport function getPrefixFromPath(path: string) {\n  return path.substring(0, path.indexOf('@'))\n}\n\nexport function isDirectory(path: string) {\n  return path.slice(-2) === '@0'\n}\n\nconst getNewFiles = async (path: string, getFiles: Function): Promise<FileArray> => {\n  let prefix: string = getPrefixFromPath(path)\n  let files: FileArray = []\n  await getFiles(prefix).then((keys: string[]) => {\n    files = Array.from(keys).map((key: string) => {\n      let entry: FileData = {\n        id: key,\n        name: lastKeyNameFromPath(key),\n        isDir: isDirectory(key),\n        isHidden: false,\n        ext: '',\n      }\n      return entry\n    })\n  })\n  return Promise.resolve(files)\n}\n\nconst getFolderChain = async (path: string): Promise<FileArray> => {\n  let rootEntry: FileData = {\n    id: '@',\n    name: 'root',\n    isHidden: false,\n    isDir: true,\n  }\n  const folderChain = []\n\n  const start = path.substring(0, path.indexOf('::')) + '::'\n  let end = path.substring(path.indexOf('::') + 2)\n\n  while (end !== '') {\n    let fullPath = start + end\n    let entry: FileData = {\n      id: fullPath,\n      name: lastKeyNameFromPath(fullPath),\n      isDir: isDirectory(fullPath),\n      isHidden: false,\n    }\n    folderChain.unshift(entry)\n\n    let lastIndex = end.lastIndexOf(':')\n    if (lastIndex !== -1) {\n      end = end.substring(0, lastIndex) + '@0'\n    } else {\n      end = ''\n    }\n  }\n\n  folderChain.unshift(rootEntry)\n\n  return Promise.resolve(folderChain)\n}\n\nexport const useFileActionHandler = (setPath: Function, displayEntry: Function) => {\n  return useCallback(\n    (data: ChonkyFileActionData) => {\n      if (data.id === ChonkyActions.OpenFiles.id) {\n        if (typeof data.payload.targetFile !== 'undefined') {\n          if (data.payload.targetFile.isDir) {\n            // go to next path/series of entries\n            setPath(data.payload.targetFile.id)\n          } else {\n            displayEntry(keyNameFromPath(data.payload.targetFile.id))\n          }\n        }\n      }\n    },\n    [setPath],\n  )\n}\n\n// const test = defineFileAction({\n//   id: 'testPrint',\n//   requiresSelection: true,\n//   button: {\n//     name: 'Test',\n//     toolbar: true,\n//     group: 'Options',\n//   },\n// })\n\n// const myFileActions = [test]\n\nconst ReadOnlyVFSBrowser: React.FC<{\n  instanceId: string\n  path: string\n  setPath: Function\n  getKeys: Function\n  displayEntry: Function\n}> = (props) => {\n  const [files, setFiles] = useState<FileArray<FileData>>([])\n  const [folderChain, setFolderChain] = useState<FileArray<FileData>>([])\n\n  useEffect(() => {\n    async function updateFolderChain() {\n      await getFolderChain(props.path).then((chain: FileArray) => {\n        setFolderChain([...chain])\n      })\n      return true\n    }\n    async function updateFiles() {\n      await getNewFiles(props.path, props.getKeys).then((files: FileArray) => {\n        setFiles([...files])\n      })\n      return true\n    }\n    updateFiles()\n    updateFolderChain()\n  }, [props.path])\n\n  const handleFileAction = useFileActionHandler(props.setPath, props.displayEntry)\n  return (\n    <div style={{ height: 400 }}>\n      <FileBrowser\n        instanceId={props.instanceId}\n        files={files}\n        // fileActions={myFileActions}\n        folderChain={folderChain}\n        onFileAction={handleFileAction}\n        thumbnailGenerator={(file: FileData) => null}\n      >\n        <FileNavbar />\n        <FileToolbar />\n        <FileList />\n        <FileContextMenu />\n      </FileBrowser>\n    </div>\n  )\n}\n\nconst Dashboard: React.FC = () => {\n  const { jwt } = useSelector((state: any) => state.jwt)\n  const { client } = useSelector((state: any) => state.client)\n  const dispatch = useDispatch()\n\n  // Keep track of current key path for file navigation\n  const [path, setPath] = useState('')\n\n  // Variables for displaying entry information\n  const defEmpty = new StorageEntry()\n  const [entry, updateDisplay] = useState(defEmpty)\n  const [visible, updateVisible] = useState(false)\n  const [displayTab, updateTab] = useState(1)\n\n  async function getKeysAtPrefix(prefix: string) {\n    let paths: string[] = []\n    if (prefix === '') {\n      await getUserStorageEntries(client, jwt).then((entries: StorageEntry[]) => {\n        paths = entries.map((entry: StorageEntry) => {\n          return entry.getKeyPath()\n        })\n      })\n    } else {\n      await getUserStorageEntries(client, jwt, prefix).then((entries: StorageEntry[]) => {\n        paths = entries.map((entry: StorageEntry) => {\n          return entry.getKeyPath()\n        })\n      })\n    }\n    return Promise.resolve(paths)\n  }\n\n  async function displayEntry(keyName: string) {\n    await readEntry(client, jwt, keyName).then((entry: StorageEntry) => {\n      updateDisplay(entry)\n      updateVisible(true)\n    })\n  }\n\n  useEffect(() => {\n    if (jwt !== '' && client !== '') {\n      setPath('@')\n    }\n  }, [jwt, client])\n\n  return (\n    <>\n      <CCard className=\"mb-4\">\n        <CCardBody>\n          <CRow>\n            <CCol sm={5}>\n              <h3 id=\"traffic\" className=\"card-title mb-0\">\n                Storage Entries\n              </h3>\n            </CCol>\n          </CRow>\n        </CCardBody>\n        <CCardFooter>\n          <CRow className=\"text-center\">\n            <ReadOnlyVFSBrowser\n              instanceId=\"ah\"\n              path={path}\n              setPath={setPath}\n              getKeys={getKeysAtPrefix}\n              displayEntry={displayEntry}\n            />\n          </CRow>\n        </CCardFooter>\n      </CCard>\n\n      <CModal\n        size=\"lg\"\n        backdrop=\"static\"\n        style={{ maxWidth: '75%', marginLeft: '12.5%' }}\n        visible={visible}\n        onClose={() => updateVisible(false)}\n        alignment=\"center\"\n      >\n        <CModalHeader>\n          <CModalTitle>Entry: {visible ? lastKeyNameFromPath(entry.getKeyPath()) : ''}</CModalTitle>\n        </CModalHeader>\n        <CModalBody>\n          <CCardGroup>\n            <CNav variant=\"tabs\" role=\"tablist\">\n              <CNavItem>\n                <CNavLink active={displayTab === 1} onClick={() => updateTab(1)}>\n                  Binary\n                </CNavLink>\n              </CNavItem>\n              <CNavItem>\n                <CNavLink active={displayTab === 2} onClick={() => updateTab(2)}>\n                  Base64\n                </CNavLink>\n              </CNavItem>\n              <CNavItem>\n                <CNavLink active={displayTab === 3} onClick={() => updateTab(3)}>\n                  String\n                </CNavLink>\n              </CNavItem>\n            </CNav>\n          </CCardGroup>\n          <CCardGroup>\n            <CCard className=\"p-2\">\n              <CCardBody className=\"text-center\">\n                <div\n                  style={{\n                    whiteSpace: 'pre-wrap',\n                    textAlign: 'left',\n                    overflowWrap: 'break-word',\n                    width: '100%',\n                  }}\n                >\n                  {visible ? JSON.stringify(storageEntryToJSON(entry, displayTab), null, 2) : ''}\n                </div>\n                <CButton className=\"ms-2\" active tabIndex={-1} color=\"light\">\n                  <a\n                    download=\"payload.txt\"\n                    href={\n                      visible\n                        ? createDownloadHref(\n                            JSON.stringify(storageEntryToJSON(entry, displayTab), null, 2),\n                          )\n                        : '#'\n                    }\n                    style={{ textDecoration: 'none', color: 'black' }}\n                  >\n                    Download Entry\n                  </a>\n                </CButton>\n              </CCardBody>\n            </CCard>\n          </CCardGroup>\n        </CModalBody>\n        <CModalFooter>\n          <CButton color=\"secondary\" onClick={() => updateVisible(false)}>\n            Close\n          </CButton>\n        </CModalFooter>\n      </CModal>\n    </>\n  )\n}\n\nexport default Dashboard\n"],"names":["getPrefixFromPath","path","substring","indexOf","isDirectory","slice","setChonkyDefaults","iconComponent","ChonkyIconFA","getNewFiles","getFiles","prefix","files","then","keys","Array","from","map","key","id","name","lastKeyNameFromPath","isDir","isHidden","ext","Promise","resolve","getFolderChain","rootEntry","folderChain","start","end","entry","fullPath","unshift","lastIndex","lastIndexOf","useFileActionHandler","setPath","displayEntry","useCallback","data","ChonkyActions","payload","targetFile","keyNameFromPath","ReadOnlyVFSBrowser","props","useState","setFiles","setFolderChain","useEffect","chain","getKeys","updateFiles","updateFolderChain","handleFileAction","style","height","instanceId","onFileAction","thumbnailGenerator","file","jwt","useSelector","state","client","useDispatch","defEmpty","StorageEntry","updateDisplay","visible","updateVisible","displayTab","updateTab","paths","getUserStorageEntries","entries","getKeyPath","keyName","readEntry","className","sm","size","backdrop","maxWidth","marginLeft","onClose","alignment","variant","role","active","onClick","whiteSpace","textAlign","overflowWrap","width","JSON","stringify","storageEntryToJSON","tabIndex","color","download","href","createDownloadHref","textDecoration"],"sourceRoot":""}